## 项目
这是自动化评估 medDQA 的文件。

### `calculate_rouge(row)`
此函数用于计算 DataFrame 中每行的 ROUGE-L 分数。它接受一个包含两个字段 `pred_clean` 和 `answer_clean` 的字典 `row` 作为输入。`pred_clean` 是模型生成的预测答案，而 `answer_clean` 是实际的参考答案。
函数内部使用了 `rouge` 库来计算两个文本之间的 ROUGE-L 分数。如果在计算过程中遇到错误，函数将打印出错误信息并返回 `None`。

#### 参数:
- `row`: DataFrame 中的一行，包含以下列：
  - `pred_clean`: 模型的预测答案。
  - `answer_clean`: 实际的参考答案。

#### 返回值:
- 如果成功计算分数，则返回 ROUGE-L 分数（浮点数）。
- 如果在计算过程中遇到任何错误，则返回 `None`。

### `calculate_acc(row)`
该函数用于计算 DataFrame 中每行预测答案的准确性。它根据不同的任务类型 `task` ，问题级别`question_level` 和答案类型`answer_type`，应用不同的逻辑来计算预测答案的准确性：

- 如果任务类型为 `factvqa` 或 `tablevqa`：
  - 当问题级别为 `single`，即单一答案时，如果预测答案 (`pred_clean`) **包含**实际答案 (`answer_clean`)，则返回 1 表示准确，否则返回 0 表示不准确。
  - 当问题级别为 `multi` 且有两个正确答案，此时：
    - 如果预测答案包含第一个部分，则得分增加 0.5；如果还包含第二个部分，则再增加 0.5。得分可以是 0、0.5 或 1。
  - 当问题级别为 `multi` 且有多个正确答案，此时：
    - 如果预测答案的多于实际答案的个数，返回 0 表示不准确。
    - 否则，计算预测答案中每个部分正确出现的比例，作为准确性得分。

- 对于临床推理 VQA (`clinical reasoning vqa`) 任务：
  - 如果答案类型为 `MC`（单项选择）：
    - 如果预测答案的多于实际答案的个数，返回 0 表示不准确。
    - 如果实际答案包含在预测答案中，返回 1 表示准确。
  - 如果答案类型为短答案（`Short Answer`）：
    - 参考rougeL。

#### 参数:
- `row`: DataFrame 中的一行，包含以下列：
  - `TASK`: 指定任务类型。
  - `question_level`: 定义问题级别，如 `single`、`multi`、`numerical`。
  - `answer_type`: 指示答案类型，如 `MC`（单项选择）、`SA`（简答）。
  - `answer_clean`: 实际参考答案。
  - `pred_clean`: 模型的预测答案。

#### 返回值:
- 准确性得分：一个介于 0 到 1 之间的浮点数，代表预测答案的准确性。1 表示完全正确，0 表示不正确。

## 主脚本流程
- 为各种任务和模型加载答案预测文件。
- 删除重复和无效条目。
- 通过替换中文标点来清理答案。
- 为每一行计算 ROUGE-L 分数和准确性。
- 按模型、问题类型和问题级别聚合结果，提供多级评估。

## 注意事项
确保数据集文件位于脚本中指定的正确位置。
脚本假定数据集中存在某些列，例如 img_path、question、pred_answer 和 answer。

